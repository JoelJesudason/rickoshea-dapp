<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Compiled and minified Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" integrity="sha256-OweaP/Ic6rsV+lysfyS4h+LM6sRwuO3euTYfr6M124g=" crossorigin="anonymous" />
  <!-- FontAwesome icons -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
</head>

<body class="grey lighten-3">


    <div class="row">
        <!-- Title & Logo -->
        <div class="col s5" style="margin-left: 5%"">
          <h3 style="margin-left: 5%">Rickoshea</h3>
          <p style="margin-left: 5%">Scaling and simplifying Dollar-cost Averaging (DCA)</p>
        </div>
        
        <!-- Form where DCA stream is initiated -->
        <div align="right" class="col s3 dapp-admin" style="margin-right: 10%"">
          <table style="width:100%">
            <tr>
              <td>App Address</td>
              <td><span class="card-title"><input id="dapp-createflow-superapp-address" placeholder="Paste here..." /></span></td>
            </tr>
            <tr>
              <td>DCA Hourly Rate</td>
              <td><span class="card-title"><input id="dapp-createflow-dca-rate" /></span></td>
            </tr>
            <tr>
              <td></td>
              <td> <a id="dapp-createflow" href="#" onclick="dApp.createFlow()">Start Streaming!</a> </td>
            </tr>
          </table>
        </div>

        <div class="col s12" style="margin: 5%"">
            <div class="card blue-grey darken-1">
              <div class="card-content white-text">
                <table style="width:100%">
                  <tr>
                    <th></th>
                    <th>App Address</th>
                    <th>Inbound Rate</th>
                    <th>Total Inflow</th>
                    <th>Total Outflow</th>
                  </tr>
                  <tr>
                    <td>maWETHx</td>
                    <td>0x376c4c43E092Bd48a9cdc8259dEc833bbD6d6860 ðŸ“‹</td>
                    <td>0 maWETHx/hr</td>
                    <td><div id="stream-num">0</div> USDCx</td>
                    <td>0 maWETHx</td>
                  </tr>
                  <tr>
                    <td>maUSDCx</td>
                    <td>0x426CA1eA2406c07d75Db9585F22781c096e3d0E0 ðŸ“‹</td>
                    <td>0 maUSDCx/hr</td>
                    <td>0 USDCx</td>
                    <td>0 maUSDCx</td>
                  </tr>
                  <tr>
                    <td>maWBTCx</td>
                    <td>0x73cc407fbae89d69f20cf15d51aa98171dc5703c ðŸ“‹</td>
                    <td>0 maWBTCx/hr</td>
                    <td>0 USDCx</td>
                    <td>0 maWBTCx</td>
                  </tr>
                </table>
            </div>
        </div>

    <!-- JQuery 3.4.1 slim minified -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
    <!-- Compiled and minified JavaScript for Materialize CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js" integrity="sha256-U/cHDMTIHCeMcvehBv1xQ052bPSbJtbuiw4QA9cTKz0=" crossorigin="anonymous"></script>
    <!-- Web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.2.5-rc.0/dist/web3.min.js" integrity="sha256-ZjUHyLZZWkQPbWfRjTSmGtfcTSOermVT6f/CvJW2RY4=" crossorigin="anonymous"></script>

    <script>

        async function ethEnabled() {
            // If the browser has an Ethereum provider (MetaMask) installed
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                window.ethereum.enable();
                return true;
            }
            return false;
        }


        async function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Number.parseFloat((progress * (end - start) + start)).toFixed(3);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        async function createFlow() {

            const rate = $("#dapp-createflow-dca-rate").val();
            const superapp_address = $("#dapp-createflow-superapp-address").val();

            console.log(rate);
            console.log(superapp_address);

            const changing_num = document.getElementById("stream-num");

            this.animateValue(changing_num,0,100000,1000000000000)

            return;

        }

        async function main() {
                // Initialize web3
        if (!this.ethEnabled()) {
            alert("Please install MetaMask to use this dApp!");
            }
        }


    </script>

</body>

</html>